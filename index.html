<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Stock Material</title>

<style>
  body {
    font-family: Arial, sans-serif;
    text-align:center;
    padding:20px;
    background:#0b1e3a;
    color:white;
  }

  h1 { margin-bottom:20px; font-size:24px; }

  button {
    width:100%;
    padding:18px;
    font-size:18px;
    margin:10px 0;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:bold;
  }

  .sin-stock { background:#d9534f; color:white; }
  .bajo-stock { background:#f0ad4e; color:black; }
  .ingreso-stock { background:#5cb85c; color:white; }

  input {
    width:100%;
    padding:12px;
    font-size:16px;
    text-align:center;
    border-radius:6px;
    border:none;
    margin:10px 0;
  }

  #msg { margin-top:15px; font-weight:bold; }

  /* Overlay PIN */
  #pin-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width:100%;
    height:100%;
    background: rgba(0,0,0,0.85);
    display:flex;
    justify-content:center;
    align-items:center;
    flex-direction: column;
    color:white;
    z-index: 1000;
  }

  #pin-overlay input {
    max-width:200px;
    margin-bottom:10px;
  }

  #pin-overlay button {
    width:auto;
  }
</style>

</head>
<body>

<!-- Overlay PIN -->
<div id="pin-overlay">
  <h2>Ingrese el PIN para acceder</h2>
  <input type="password" id="pinInput" placeholder="PIN">
  <button onclick="verificarPIN()">Ingresar</button>
  <p id="pin-msg" style="color:red; margin-top:10px;"></p>
</div>

<!-- Contenido -->
<div id="contenido" style="display:none;">
  <h1 id="material-title">Material no identificado</h1>

  <button class="sin-stock" onclick="enviar('SIN STOCK')">
    üö® SIN STOCK
  </button>

  <input type="number" id="cantidad" placeholder="Cantidad disponible">

  <button class="bajo-stock" onclick="enviar('BAJO STOCK')">
    ‚ö†Ô∏è BAJO STOCK
  </button>

  <button class="ingreso-stock" onclick="enviar('INGRESO STOCK')">
    ‚ûï INGRESO STOCK
  </button>

  <p id="msg"></p>
</div>

<script>
  const PIN_CORRECTO = "1812";

  function verificarPIN() {
    const pin = document.getElementById("pinInput").value;
    const msg = document.getElementById("pin-msg");

    if (pin === PIN_CORRECTO) {
      document.getElementById("pin-overlay").style.display = "none";
      document.getElementById("contenido").style.display = "block";
    } else {
      msg.textContent = "PIN incorrecto";
      document.getElementById("pinInput").value = "";
    }
  }

  // Material desde URL
  const params = new URLSearchParams(window.location.search);
  let material = params.get("material") || "";

  material = material
    .replace(/_X_/g, " x ")
    .replace(/(\d+)_(\d+)/g, "$1.$2")
    .replace(/_/g, " ")
    .replace(/KGS/i, "Kgs");

  document.getElementById("material-title").innerText =
    material || "Material no identificado";

  const FORM_URL =
    "https://docs.google.com/forms/d/e/1FAIpQLSdvvyZy8DPPBssML6_LGJLXUpKL58icIbzOb4LDR2PQrYUBlg/formResponse";

  const ENTRY_MATERIAL = "entry.1737009670";
  const ENTRY_ESTADO   = "entry.1416497766";
  const ENTRY_CANTIDAD = "entry.794276494";

  function enviar(estado) {
    const cantidad = document.getElementById("cantidad").value;

    if (!material) {
      alert("Material no identificado");
      return;
    }

    if ((estado === "BAJO STOCK" || estado === "INGRESO STOCK") && !cantidad) {
      alert("Deb√©s ingresar la cantidad");
      return;
    }

    const data = new FormData();
    data.append(ENTRY_MATERIAL, material);
    data.append(ENTRY_ESTADO, estado);
    data.append(ENTRY_CANTIDAD, cantidad || 0);

    fetch(FORM_URL, { method:"POST", mode:"no-cors", body:data });

    document.getElementById("msg").innerText = "‚úîÔ∏è Aviso enviado";
    document.getElementById("cantidad").value = "";
  }
</script>

</body>
</html>
